{% extends "base.html" %}<!DOCTYPE html>
{% block css %}

	<style>

		.top-tag {
			text-align: left;
			margin-left: 5%;
			font-weight: bold;
		}
		
		.main-text-container {
			margin: 0 auto;
			width: 80%;
		}

		.separator-commentsection {
		}

		.comment-layout {
			width: 80%;
			margin: 10px auto 0;
			padding: 10px;
			background: #b8b8b8;		
		}

		.comment-layout > .user-info,	
		.comment-layout > .date {
			text-align: left;	
		}

		.comment-layout > .separator-info {
			margin: 0 0 10px;
			width: auto;
			border: none;
			background-color: #686868;
			/* color: #E8E8E8; was also in the example, 
			   but seems you can leave it out */
			height: 1px;
		}

		.comment-layout > p {
			text-align: left;
			margin: 0;
		}

	</style>

{% endblock css %}
{% block toptag %}	

	<div class="top-tag">Philo-b</div>

{% endblock toptag %}
{% block header %}

	{{ object.title }}

{% endblock header %}
{% block subheader %}

	{{ object.introduction }}

{% endblock subheader %}
{% block content %}
<!-- maybe add some safe filters on the post and comments. 
	 dunno why you would use the linebreaks option for the
	 comments, safe seems a better option to me -->
	<div class="main-text-container">
		{{ post.body }}
	</div>

{% endblock content %}
{% block comments %}
	<hr class="separator-commentsection">
	{% for comment in comments %}

		<div class="comment-layout" id="comment-{{ comment.id }}">

			<div class="user-info">
				<strong>{{ comment.author_id }}</strong></div>
			<div class="date">{{ comment.pub_date }}</div>
			<hr class="separator-info">
			<p>{{ comment.content|linebreaks }}</p>
			<!--a href="#comment-{{ comment.id }}">#</a-->

		</div>

		<div id="comment-{{ comment.id }}"></div>
		{% if form %}

			<a class="button" onclick="return show_comments_form({{ comment.id }})">
				<button>reply</button>
			</a>

		{% endif %}
	{% empty %}

		<p>No comments here yet :(</p>

	{% endfor %}
	{% if form %}

        <h3 id="write_comment"><a onclick="return show_comments_form('write_comment')">Write a comment.</a></h3>

		<form id="comment_form" action="{% url 'add_comment' post.id %}" method="POST">
			{% csrf_token %}
			{{ form.as_p }}
			<button type="submit" class="save">Save</button>
		</form>

	{% else %}

		<div class="no-login">
			<div class="no-login-heading">
				<h3 class="no-login-title"></h3>
			</div>
			<div class="no-login-body">
				Только авторизованные пользователи могут оставлять комментарии.<br />
			</div>
		</div>

	{% endif %}

{% endblock comments %}
{% block javascript %}

	<script>

		function show_comments_form(parent_comment_id) {
			if (parent_comment_id == 'write_comment') {
				 document.getElementById("id_parent_comment").value = ''
			} else {
				document.getElementById("id_parent_comment").value = parent_comment_id
				parent_comment_id = "comment-" + parent_comment_id
			}

			document.getElementById("comments-container")
				.insertBefore(
						document.getElementById("comment_form"),
						document.getElementById(parent_comment_id).nextSibling
				)
		}

	</script>

{% endblock javascript %}

