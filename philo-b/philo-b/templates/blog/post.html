<!DOCTYPE html>
{% extends "base.html" %}
{% load static %}

{% block javascript %}

	<script src="{% static 'js/blog/post.js' %}"></script>

{% endblock javascript %}

{% block css %}

	<link rel="stylesheet" href="{% static 'css/blog/post.css' %}" type="text/css" media="screen">

{% endblock css %}
{% block toptag %}	

	<div class="top-tag">Philo-b</div>

{% endblock toptag %}
{% block header %}

	{{ object.title }}

{% endblock header %}
{% block subheader %}

	{{ object.introduction }}

{% endblock subheader %}
{% block content %}
<!-- maybe add some safe filters on the post and comments. 
	 dunno why you would use the linebreaks option for the
	 comments, safe seems a better option to me -->
	<div class="main-text-container">
		{{ post.body }}
	</div>

{% endblock content %}
{% block comments %}

	<hr class="separator-commentsection">

	{% if not comment_form %}

		<a class="login-links" href="{% url 'account_login' %}?next={{ request.path }}">Sign in</a> to reply or comment.<br><br>

	{% endif %}

	<script>

		function tempor(vari) {
			var ht = "<div><strong>just typing stuff plusssss " + vari + " Iiiiii wanted to add</strong></div>"
			return ht
		}

		function place_comment(data) {
			console.log('started executing')

			var comments_container = document.getElementById('comments_container') 
			html_text = template_comments(data)
			comments_container.insertAdjacentHTML('beforeend', html_text)

			console.log('finished executing')
		}
		
		function template_comments(data) {
		
			var html_text =
				"<div class=\"reply-layout " + data.is_first + "\" id=\"comment-" + data.id + "\">" +
					"<div class=\"post-info\">" +
						"<div class=\"user-info\">" +
							"<strong>" + data.author_id + "</strong></div>" +
							"<div style=\"text-align:center;\"><strong>" + data.path +
									"/" + data.is_first + "/" + data.is_last + "</strong></div>" +
						"<div class=\"date\">" + data.pub_date + "</div>" +
					"</div>" +
					"<hr class=\"separator-info\">" +
					"<p>" + data.content + "</p>"

			return html_text
		}

	</script>

	<script id='comment_template' type='text/template'>

		<div class="reply-layout" <%is_first%> id="comment-"{{id}}>
			<div class="post-info"> 
				<div class="user-info">
					<strong>{{author_id}}</strong></div>
					<div style="text-align:center;"><strong>{{path}}
							/ {{is_first}} / {{is_last}}</strong></div>
				<div class="date">{{pub_date}}</div>
			</div> 
			<hr class="separator-info">
			<p>{{content}}</p>

	</script>

	{% for comment in comments %}

			<script type='text/javascript'>
			// 	// Very much superfluous, can just pass this on to the template
			// 	// it can then pick out what it needs. IF... I can somehow
			// 	// pass it on so that the script wont need the tags. (maybe
			// 	// parse it as json?
			// 	// and what todo about those linebreaks then?
			// 	var data = { 'is_first': '{{ comment.is_first }}',
			// 				 'id': '{{ comment.id }}',
			// 				 'author_id': '{{ comment.author_id }}',
			// 				 'path': '{{ comment.path }}',
			// 				 'is_last': '{{ comment.is_last }}',
			// 				 'pub_date': '{{ comment.pub_date }}',
			// 				 'content': '{{ comment.content|linebreaks }}',
			// 				}
			// 	place_comment(data)
			</script>

			<script type='text/javascript'>

				console.log('started executing')

				var template = document.getElementById('comment_template').innerHTML
				console.log(template)
				debugger

				template.replace(/<%is_first%>/g, 'thissssssss')
				console.log(template)
				debugger


				// var comments_container = document.getElementById('comments_container') 
				// html_text = template_comments(data)
				// comments_container.insertAdjacentHTML('beforeend', html_text)

				console.log('finished executing')
			
			</script>


		{% if comment_form and comment.is_last %}

			<div class="button-container">
				<a class="comment" 
				onclick="return create_subcomment_form({{ comment.id }})">
					<button class="reply">reply</button></a>
			</div>

		{% endif %}

		</div>
		<div style="clear:both;"></div>

		{% if not comment_form and comment.is_last %}

			<br><br>

		{% endif %}

	{% empty %}

		<p>No comments have been posted here</p>

	{% endfor %}

	{% if comment_form %}

		<div class="comment-layout" id="comment-new">

			<form id="comment-default" action="{% url 'add_comment' post.id %}" method="POST">
				{% csrf_token %}
				<!!!!!!!!-- this has an id, seems dodgy -->
				<div id="form-area-wrapper"> 
					<hr class="separator-form">
					<div class="form-userinfo">Write response with username 
						<span class="form-username">{{ user.username }}</span>:
					</div>
					<ul class="submit-errors" id="submit-errors-default"></ul>
					{{ comment_form.as_p }}
				</div>
				<div class="form-instructions">
					<ul>
						Practical information:<br/>
						<li>layout is not fully maintained, for example: 
						consecutive spaces are shown as one single space, 
						as are new lines/enters/breaks.
						<li>html code is read as plaintext.
					</ul>
				</div>
			</form>

			<div class="button-container">
				<button class="submit" 
					onclick="return submit_comment_form()">submit</button>
			</div>

		</div>


	{% else %}

	<hr class="separator-commentsection">
	<br>
		<div class="no-login">
			<div class="no-login-heading">
				<h3 class="no-login-title"></h3>
			</div>
			<div class="no-login-body">
				<a class="login-links" href="{% url 'account_login' %}?next={{ request.path }}">Sign in</a> to reply or comment.</div>
				<br><br>
		</div>

	{% endif %}

	<script>

		// function get_ajax() {
		// 	// no short notations in both functions.
		// 	var ej = JSON.parse('{{ errors_json|safe }}');
		// 	return ej
		// }

		// function get_url_ajax() {
		// 	var jp = '{% url 'okok' %}'
		// 	return jp 
		// }

		function get_url_ajax() {
			var jp = '{% url 'okok' %}'
			return jp 
		}

	</script>


{% endblock comments %}

