<!DOCTYPE html>
{% extends "base.html" %}
{% load static %}

{% block javascript %}

	<script src="{% static 'js/blog/post.js' %}"></script>

{% endblock javascript %}

{% block css %}

	<link rel="stylesheet" href="{% static 'css/blog/post.css' %}" type="text/css" media="screen">

{% endblock css %}
{% block toptag %}	

	<div class="top-tag">Philo-b</div>

{% endblock toptag %}
{% block header %}

	{{ object.title }}

{% endblock header %}
{% block subheader %}

	{{ object.introduction }}

{% endblock subheader %}
{% block content %}
<!-- maybe add some safe filters on the post and comments. 
	 dunno why you would use the linebreaks option for the
	 comments, safe seems a better option to me -->
	<div class="main-text-container">
		{{ post.body }}
	</div>

{% endblock content %}
{% block comments %}

	<hr class="separator-commentsection">

	{% if not comment_form %}

		<a class="login-links" href="{% url 'account_login' %}?next={{ request.path }}">Sign in</a> to reply or comment.<br><br>

	{% endif %}

	{% for comment in comments %}

		<!--<span class="comment {{ comment.is_first }} line-connector"></span> -->

			<div class="reply-layout {{ comment.is_first }}" id="comment-{{ comment.id }}">
				<div class="post-info">
					<div class="user-info">
						<strong>{{ comment.author_id }}</strong></div>
						<div style="text-align:center;"><strong>{{ comment.path }}
								/ {{ comment.is_first }} / {{ comment.is_last }}</strong></div>
					<div class="date">{{ comment.pub_date }}</div>
				</div>
				<hr class="separator-info">
				<p>{{ comment.content|linebreaks }}</p>

		{% if comment_form and comment.is_last %}

			<!--
			{% if errors %}
				{% for error in errors %} 
					{% if error.id == comment.id %}

						<ul>
							<li>{{ error.message }}</li>
						</ul>

						span class="submit-attempt"></span>
							create_subcomment_form({{ comment.id }}, false)

					{% endif %}
				{% endfor %}
			{% endif %}
			-->

			<div class="button-container">
				<a class="comment" 
				onclick="return create_subcomment_form({{ comment.id }})">
					<button class="reply">reply</button></a>
			</div>

		{% endif %}

		</div>
		<div style="clear:both;"></div>

		{% if not comment_form and comment.is_last %}

			<br><br>

		{% endif %}

	{% empty %}

		<p>No comments have been posted here</p>

	{% endfor %}
	{% if comment_form %}

		<div class="comment-layout" id="comment-new">

			<form id="comment-default" action="{% url 'add_comment' post.id %}" method="POST">
				{% csrf_token %}
				<!!!!!!!!-- this has an id, seems dodgy -->
				<div id="form-area-wrapper"> 
					<hr class="separator-form">
					<div class="form-userinfo">Write response with username 
						<span class="form-username">{{ user.username }}</span>:
					</div>
					<ul class="submit-errors" id="submit-errors-default"></ul>
					{{ comment_form.as_p }}
				</div>
				<div class="form-instructions">
					<ul>
						Practical information:<br/>
						<li>layout is not fully maintained, for example: 
						consecutive spaces are shown as one single space, 
						as are new lines/enters/breaks.
						<li>html code is read as plaintext.
					</ul>
				</div>
			</form>

			<div class="button-container">
				<button class="submit" 
					onclick="return submit_comment_form()">submit</button>
			</div>

		</div>

	{% else %}

	<hr class="separator-commentsection">
	<br>
		<div class="no-login">
			<div class="no-login-heading">
				<h3 class="no-login-title"></h3>
			</div>
			<div class="no-login-body">
				<a class="login-links" href="{% url 'account_login' %}?next={{ request.path }}">Sign in</a> to reply or comment.</div>
				<br><br>
		</div>

	{% endif %}
	
	<div>errors_json: {{ errors_json }}</div>
	<div>errors.0: {{ errors.0 }}</div>

	<script>
		function get_errors_json() {
			var ej = JSON.parse('{{ errors_json|safe }}');
			return ej
		}
		set_previous_submits(get_errors_json());
	</script>


{% endblock comments %}

